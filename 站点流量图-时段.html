<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";padding:0;font-size: 8px;}
		svg{width:100%;}
	</style>
	<script type="text/javascript" src="jquery.js"></script>
	<title>画图</title>
</head>
<body>
<div>
	<input id="value" style="width:30px;margin:30px 0 0 100px;" type="text" value="3"/> x 5 Min</br>
	<div style="margin:10px 0 0 100px;">颜色<input style="width:30px;margin-bottom:10px" id="maxvalue"  type="text" value="60"/></br><button id="setbut">设置</button></div>
</div>
<div id="svgdiv">

</div>
<div >
	<button id="next">下一页</button>
	<button id="prev">上一页</button>
</div>
</body>
</html>
<script type="text/javascript" src="pixel.js"></<script>

</script>
<script type="text/javascript">
	var MAXF = 60;
		function color(i){
			var step=[
				{r:0xe7,g:0xe7,b:0xe7}//gray
				,{r:0,g:0xff,b:0}//"#00ff00"//green
				,{r:0xff,g:0xff,b:0}//"#ffff00"//yellow
				,{r:0xff,g:0,b:0}//"#ff0000"//red
			];
			var cc = MAXF/step.length;
			var ci = Math.floor(i/cc);
			if(ci>= step.length - 1)
				ci = step.length - 2;
			var rate = (i - ci * cc) / cc;
			if(rate>1)rate = 1;
			var r,g,b;
			r = step[ci].r + (step[ci+1].r - step[ci].r)*rate;
			g = step[ci].g + (step[ci+1].g - step[ci].g)*rate;
			b = step[ci].b + (step[ci+1].b - step[ci].b)*rate;
			return "#"+c2s(r)+c2s(g)+c2s(b);
		}
		function c2s(v){
			if(v>255)v=255;
			var trans=['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'];
			return trans[Math.floor(v/16)]+trans[Math.floor(v)%16];
		}
		function draw(x,y,w,h,data){
			var html="";
			if(data[0]){
				for(var i = 0;i<24;i++){
					html += '<text x="'+(x+w*(data[0].length-1)*i/24)+'"" y="'+(y-10)+' \">'+i+'</text>';
				}
			}
			for(var i = 0;i<data.length;i++){
				if(data[i][0]){
					html+='<text x="'+(x-90)+'" y="'+(y+i*h+10)+'" >'+data[i][0]+'</text>';
				}
				for(var j = 1;j<data[i].length;j++){
					html +='<rect x="'+(x+(j-1)*w)+'" y="'+(y+i*h)+'" width="'+w+'" height="'+h+'" fill="'+color(data[i][j])+'" stroke-width=0.5 stroke=rgb(0,0,0)></rect>';
				}
			}

			if(data[0]){
				$("#svgdiv").append("<svg style=\"height:"+(y+(data.length+2)*h)+"px\">"+html+"</svg>");
				$("#svgdiv").width(x+(data[0].length+2)*w);
			}
		}

		function display(data,COUNT){
			var disdata=[];
			var DELTA = 5*60;

			for(var i = 1;i<30;i++){
				var datai = data[""+i];
				if(!datai)continue;
				var line=[datai["name"]];

				for (var j = 0;j<24*60*60;){
					var total = 0;
					for(var k = 0;k<COUNT;k++){
						var st = ""+j;
						if(datai[st]){
							total += datai[st].up;
							total += datai[st].off;
						}
						j += DELTA;
					}
					line.push(total);
				}
				disdata.push(line);
			}
			draw(100,50,10,10,disdata);
		}
		var pagebegin = 1;
		var pagecount = 50;
		function sss(){
			var c = parseInt($("#value").val());
			MAXF = parseInt($("#maxvalue").val());
			$("#svgdiv").html("");
			for (var i = 0;i<datas.length&&i<pagecount;i++){
				display(datas[i+pagebegin],c);
				}
		};
		sss();
		$("#next").click(function(){
			pagebegin += pagecount;
			if(pagebegin>=datas.length)
				pagebegin = datas.length;
			sss();
		});
		$("#prev").click(function(){
			pagebegin -= pagecount;
			if(pagebegin<=0)
				pagebegin = 0;
			sss();
		});
		$("#setbut").click(sss);
</script>
